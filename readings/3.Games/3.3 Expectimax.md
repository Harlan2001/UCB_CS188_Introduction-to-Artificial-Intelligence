## 3.3 Expectimax

我们现在已经了解了 minimax 的工作原理，以及完整运行 minimax 如何使我们能够在面对最优对手时做出最优响应。然而，minimax 在其适用情境方面存在一些天然限制。由于 minimax 假设对手是最优行动的，它在那些无法保证对手会对智能体行动做出最优回应的情境中往往过于悲观。这类情境包括具有内在随机性的场景，例如纸牌或骰子游戏，或者对手随机行动或采取次优行动的情况。关于具有内在随机性的情境，我们将在课程后半部分讨论马尔可夫决策过程时更详细地介绍。

这种随机性可以通过 minimax 的一种推广形式来表示，即 expectimax。Expectimax 在博弈树中引入了机会节点（chance nodes），这些节点不像最小化节点那样考虑最坏情况，而是考虑平均情况。更具体地说，最小化节点只是计算其子节点中的最小效用，而机会节点计算的是期望效用或期望值。我们在 expectimax 中用于确定节点价值的规则如下：

\[
\forall \text{智能体控制的状态}, \quad
V(s) = \max_{s' \in successors(s)} V(s')
\]

\[
\forall \text{机会状态}, \quad
V(s) = \sum_{s' \in successors(s)} p(s'|s)\, V(s')
\]

\[
\forall \text{终止状态}, \quad
V(s) = known
\]

在上述公式中，\( p(s'|s) \) 表示：在给定状态 \( s \) 下，一个非确定性动作导致转移到状态 \( s' \) 的概率；或者表示对手选择某个动作而导致从状态 \( s \) 转移到状态 \( s' \) 的概率，这取决于所考虑的具体博弈及其博弈树结构。从这个定义可以看出，minimax 只是 expectimax 的一个特例。最小化节点实际上是这样一种机会节点：它为其值最小的子节点赋予概率 1，而为其他所有子节点赋予概率 0。一般来说，概率的选择应当正确反映我们试图建模的博弈状态，但关于这一过程的具体细节，我们将在后续讲义中更详细地讨论。目前可以认为这些概率是博弈本身的固有属性。

expectimax 的伪代码与 minimax 非常相似，只需对计算期望效用而非最小效用进行少量修改，因为我们将最小化节点替换为机会节点：

![](../../image/3.Games/expectimax-pseudocode.png)

Expectimax Pseudocode

在继续之前，让我们快速通过一个简单示例。考虑如下 expectimax 树，其中机会节点用圆形节点表示，而不是最大化/最小化节点所用的上下三角形。

![](../../image/3.Games/unfilled-expectimax.png)

Unfilled Expectimax

为简单起见，假设每个机会节点的所有子节点出现的概率均为  
1/3。  
根据我们关于节点价值确定的 expectimax 规则，从左到右三个机会节点的取值分别为：

\[
\frac{1}{3}\cdot 3 + \frac{1}{3}\cdot 12 + \frac{1}{3}\cdot 9 = 8
\]

\[
\frac{1}{3}\cdot 2 + \frac{1}{3}\cdot 4 + \frac{1}{3}\cdot 6 = 4
\]

\[
\frac{1}{3}\cdot 15 + \frac{1}{3}\cdot 6 + \frac{1}{3}\cdot 0 = 7
\]

最大化节点在这三个值中选择最大值  
8，  
从而得到如下填充后的博弈树：

![](../../image/3.Games/filled-expectimax.png)

Filled Expectimax

关于 expectimax 的最后一点需要注意的是：一般来说，我们必须查看所有机会节点的子节点——我们不能像在 minimax 中那样进行剪枝。在 minimax 中计算最小值或最大值时，单个值不会无限制地改变结果；但在 expectimax 中，一个单独的值可能会将期望值任意拉高或拉低。不过，当我们对节点可能的取值具有已知且有限的界限时，仍然可能进行剪枝。

---

## 3.3.1 Mixed Layer Types

尽管 minimax 和 expectimax 分别要求最大化/最小化节点交替出现，以及最大化/机会节点交替出现，但许多博弈并不严格遵循这两种算法所规定的交替模式。即使在吃豆人中，当吃豆人行动之后，通常也有多个幽灵依次行动，而不是只有一个幽灵。我们可以通过在博弈树中灵活地添加层来处理这种情况。在包含四个幽灵的吃豆人游戏中，可以设置为：一个最大化层，之后是连续 4 个幽灵/最小化层，然后再进入下一个吃豆人/最大化层。实际上，这种做法天然地在所有最小化节点之间产生协作，因为它们轮流进一步最小化最大化节点所能获得的效用。甚至可以将机会节点层与最小化和最大化节点结合起来。如果在一个包含两个幽灵的吃豆人游戏中，其中一个幽灵随机行动，另一个幽灵最优行动，我们可以通过交替排列最大化—机会—最小化节点组来模拟这种情况。

![](../../image/3.Games/mixed-layer.png)

Mixed Layer

显而易见，节点分层具有相当大的灵活变化空间，这使我们能够为任何零和博弈构建博弈树，并开发经过修改的 expectimax/minimax 混合型对抗搜索算法。
